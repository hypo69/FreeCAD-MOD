# ğŸ“˜ Cours : CrÃ©ation d'add-ons pour FreeCAD  
## LeÃ§on 3. CrÃ©ation d'objets 3D : boÃ®te paramÃ©trique

> **Objectif de la leÃ§on** : apprendre Ã  crÃ©er des corps solides (boÃ®tes, cylindres) via Python, comprendre la structure du document FreeCAD et crÃ©er un add-on qui construit une piÃ¨ce paramÃ©trique.

---

## ğŸ§± Partie 1. Comment est structurÃ© un document dans FreeCAD ?

Avant de crÃ©er des objets, il est important de comprendre la **hiÃ©rarchie des donnÃ©es** dans FreeCAD :

```
Document (document)
â””â”€â”€ Object (objet)
    â””â”€â”€ Shape (gÃ©omÃ©trie)
```

- **Document** â€” est un fichier ouvert (`.FCStd`). Tout ce que vous crÃ©ez se trouve Ã  l'intÃ©rieur du document.
- **Object** â€” est un objet paramÃ©trique : boÃ®te, cylindre, esquisse, etc.
- **Shape** â€” est un corps gÃ©omÃ©trique (B-Rep) qui peut Ãªtre visualisÃ©.

> ğŸ’¡ Vous travaillez toujours **dans le contexte du document actif**.

### Comment obtenir le document actuel ?

```python
doc = FreeCAD.ActiveDocument
```

Si aucun document n'existe, crÃ©ez-en un nouveau :

```python
doc = FreeCAD.newDocument("MyDesign")
```

---

## ğŸ“¦ Partie 2. CrÃ©ation d'une boÃ®te (Box) via Python

L'objet 3D le plus simple dans FreeCAD est **Part::Box**.

Exemple de code :
```python
doc = FreeCAD.ActiveDocument or FreeCAD.newDocument()
box = doc.addObject("Part::Box", "MyBox")
box.Length = 20.0
box.Width = 10.0
box.Height = 5.0
doc.recompute()
```

### Que se passe-t-il ici ?

1. `doc.addObject("Part::Box", "MyBox")`  
   â†’ crÃ©e un nouvel objet de type **Box** nommÃ© `"MyBox"`
2. L'objet a des **propriÃ©tÃ©s paramÃ©triques** : `Length`, `Width`, `Height`
3. `doc.recompute()`  
   â†’ reconstruit le modÃ¨le (obligatoire aprÃ¨s modification des paramÃ¨tres !)

> ğŸ”¸ Toutes les dimensions sont en **millimÃ¨tres** (par dÃ©faut dans FreeCAD).

---

## ğŸ›  Partie 3. Add-on : Â« BoÃ®te paramÃ©trique Â»

Maintenant, crÃ©ons un add-on qui crÃ©e une boÃ®te avec des dimensions donnÃ©es.

### Ã‰tape 1. CrÃ©ez un dossier

```
.../Mod/ParamBoxAddon/
```

### Ã‰tape 2. Fichier `InitGui.py`

```python
# InitGui.py
import FreeCADGui
from ParamBoxAddon.param_box_workbench import ParamBoxWorkbench

FreeCADGui.addWorkbench(ParamBoxWorkbench())
```

### Ã‰tape 3. Fichier `param_box_workbench.py`

```python
# param_box_workbench.py
import FreeCAD, FreeCADGui

class CreateBoxCommand:
    def GetResources(self):
        return {
            "MenuText": "Create Box",
            "ToolTip": "Create a parametric box with default size"
        }

    def Activated(self):
        # Obtenir ou crÃ©er un document
        doc = FreeCAD.ActiveDocument
        if not doc:
            doc = FreeCAD.newDocument("BoxDesign")

        # CrÃ©er l'objet Box
        box = doc.addObject("Part::Box", "MyParamBox")
        box.Length = 30.0
        box.Width = 20.0
        box.Height = 10.0

        # Le recalcul est obligatoire !
        doc.recompute()

        # Optionnel : focus sur l'objet
        FreeCADGui.Selection.clearSelection()
        FreeCADGui.Selection.addSelection(box)

    def IsActive(self):
        return True


class ParamBoxWorkbench(FreeCADGui.Workbench):
    MenuText = "Parametric Box"
    ToolTip = "Create a simple parametric box"

    def Initialize(self):
        self.list = ["CreateBoxCommand"]
        self.appendToolbar("Box Tools", self.list)
        self.appendMenu("ParamBox", self.list)

    def GetClassName(self):
        return "Gui::PythonWorkbench"


FreeCADGui.addCommand("CreateBoxCommand", CreateBoxCommand())
```

---

## â–¶ï¸ Ã‰tape 4. VÃ©rification du fonctionnement

1. Enregistrez les fichiers
2. RedÃ©marrez FreeCAD
3. SÃ©lectionnez l'environnement de travail **Â« BoÃ®te paramÃ©trique Â»**
4. Cliquez sur le bouton **Â« Create Box Â»**

âœ… Un **parallÃ©lÃ©pipÃ¨de gris** devrait apparaÃ®tre dans la fenÃªtre 3D.

### VÃ©rifiez la parametricitÃ© !

1. Dans l'**arborescence du projet** (ModÃ¨le), double-cliquez sur `MyParamBox`
2. Dans le panneau **DonnÃ©es**, modifiez, par exemple, `Length` Ã  `50`
3. Appuyez sur **EntrÃ©e** â†’ le modÃ¨le **se mettra Ã  jour automatiquement** !

C'est la **modÃ©lisation paramÃ©trique**.

---

## ğŸ” Partie 4. Autres objets de base

Vous pouvez crÃ©er plus que de simples boÃ®tes. Voici quelques exemples :

### Cylindre
```python
cyl = doc.addObject("Part::Cylinder", "MyCylinder")
cyl.Radius = 10.0
cyl.Height = 25.0
```

### SphÃ¨re
```python
sphere = doc.addObject("Part::Sphere", "MySphere")
sphere.Radius = 15.0
```

### CÃ´ne
```python
cone = doc.addObject("Part::Cone", "MyCone")
cone.Radius1 = 10.0  # rayon infÃ©rieur
cone.Radius2 = 5.0   # rayon supÃ©rieur
cone.Height = 20.0
```

> ğŸ’¡ Tous ces objets se trouvent dans le module **Part**, qui est intÃ©grÃ© Ã  FreeCAD.

---

## ğŸ§ª Exercice pratique

1. Modifiez l'add-on pour qu'il crÃ©e un **cylindre**, au lieu d'une boÃ®te.
2. Faites en sorte que lors de la crÃ©ation, l'objet reÃ§oive un **nom unique** (par exemple, `Box_1`, `Box_2`...) si un objet portant ce nom existe dÃ©jÃ .
3. Ajoutez une deuxiÃ¨me commande â€” Â« Create Cylinder Â» â€” au mÃªme environnement de travail.

Indice pour le nom unique :
```python
base_name = "MyBox"
index = 1
name = base_name
while name in doc.Objects:
    name = f"{base_name}_{index}"
    index += 1
box = doc.addObject("Part::Box", name)
```

---

## ğŸ’¡ Conseils de dÃ©bogage

- Appelez toujours `doc.recompute()` aprÃ¨s avoir modifiÃ© les paramÃ¨tres
- Utilisez `FreeCAD.Console.PrintMessage("Texte\n")` pour le dÃ©bogage (les messages apparaÃ®tront dans la Vue Rapport)
- VÃ©rifiez si le document existe avant de travailler avec lui

---

## â–¶ï¸ Et ensuite ?

Dans la **LeÃ§on 4**, nous allons :
- Apprendre Ã  crÃ©er une **interface graphique (GUI)** avec des champs de saisie
- CrÃ©er une fenÃªtre oÃ¹ l'utilisateur saisit la longueur, la largeur et la hauteur
- Et en cliquant sur un bouton â€” une boÃ®te avec ces paramÃ¨tres est construite

Ce sera dÃ©jÃ  un **vÃ©ritable outil**, et non une simple dÃ©monstration !

