# AI –∞—Å—Å–∏—Ç–µ–Ω—Ç –¥–ª—è FreeCAD **–ß–∞—Å—Ç—å 2**
## –ß–∞—Å—Ç—å 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ (Markdown, plain text)

–¢–µ–ø–µ—Ä—å –º—ã –¥–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ–∫—Å—Ç** ‚Äî –ª–∏–±–æ –∏–∑ —Ñ–∞–π–ª–æ–≤ (`.txt`, `.md`), –ª–∏–±–æ –≤–≤–æ–¥–∏—Ç—å –≤—Ä—É—á–Ω—É—é –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **Markdown**.

---

## üìÅ –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–¥–¥–æ–Ω–∞

```
AIAssistant/
‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îÇ       ‚îú‚îÄ‚îÄ ai_assistant.svg
‚îÇ       ‚îú‚îÄ‚îÄ load_image.svg
‚îÇ       ‚îî‚îÄ‚îÄ load_text.svg      ‚Üê –Ω–æ–≤–∞—è –∏–∫–æ–Ω–∫–∞
‚îú‚îÄ‚îÄ InitGui.py
‚îú‚îÄ‚îÄ ai_assistant_workbench.py  ‚Üê –æ–±–Ω–æ–≤–ª—ë–Ω
‚îî‚îÄ‚îÄ data/                      ‚Üê —Å—é–¥–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏ —Ç–µ–∫—Å—Ç—ã
```

---

## üìÑ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `ai_assistant_workbench.py`

–ú—ã —Ä–∞—Å—à–∏—Ä–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥, –¥–æ–±–∞–≤–∏–≤ **–Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É `LoadTextCommand`** –∏ **–¥–∏–∞–ª–æ–≥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º**.

```python
# ai_assistant_workbench.py
import FreeCAD, FreeCADGui
import os
import shutil
from pathlib import Path
from PySide import QtGui, QtCore

# –ü–∞–ø–∫–∞ –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö AIAssistant
AI_DATA_DIR = os.path.join(FreeCAD.getUserAppDataDir(), "AIAssistant", "data")
os.makedirs(AI_DATA_DIR, exist_ok=True)

# === –ö–û–ú–ê–ù–î–ê: –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø (–∏–∑ –ß–∞—Å—Ç–∏ 1) ===
class LoadImageCommand:
    def GetResources(self):
        icon_path = os.path.join(os.path.dirname(__file__), "Resources", "icons", "load_image.svg")
        return {
            "MenuText": "Load Image",
            "ToolTip": "Load image (PNG, JPG, SVG) into AI workspace",
            "Pixmap": icon_path
        }

    def Activated(self):
        files, _ = QtGui.QFileDialog.getOpenFileNames(
            None,
            "Select Image Files",
            "",
            "Image Files (*.png *.jpg *.jpeg *.bmp *.svg *.gif)"
        )
        if not files:
            return

        for src in files:
            self._copy_file_safe(src)

    def _copy_file_safe(self, src):
        filename = os.path.basename(src)
        dst = os.path.join(AI_DATA_DIR, filename)
        if os.path.exists(dst):
            name, ext = os.path.splitext(filename)
            counter = 1
            while os.path.exists(os.path.join(AI_DATA_DIR, f"{name}_{counter}{ext}")):
                counter += 1
            dst = os.path.join(AI_DATA_DIR, f"{name}_{counter}{ext}")
        try:
            shutil.copy2(src, dst)
            FreeCAD.Console.PrintMessage(f"[AIAssistant] Saved: {dst}\n")
        except Exception as e:
            FreeCAD.Console.PrintError(f"[AIAssistant] Copy error: {str(e)}\n")
            QtGui.QMessageBox.critical(None, "Error", f"Failed to copy:\n{str(e)}")

    def IsActive(self):
        return True


# === –ö–û–ú–ê–ù–î–ê: –ó–ê–ì–†–£–ó–ö–ê –¢–ï–ö–°–¢–ê ===
class LoadTextCommand:
    def GetResources(self):
        icon_path = os.path.join(os.path.dirname(__file__), "Resources", "icons", "load_text.svg")
        return {
            "MenuText": "Load Text",
            "ToolTip": "Load or write text (Markdown, plain text)",
            "Pixmap": icon_path
        }

    def Activated(self):
        dialog = TextEditorDialog()
        dialog.exec_()

    def IsActive(self):
        return True


# === –î–ò–ê–õ–û–ì: –†–ï–î–ê–ö–¢–û–† –¢–ï–ö–°–¢–ê ===
class TextEditorDialog(QtGui.QDialog):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("AI Assistant ‚Äî Text Editor")
        self.resize(600, 500)

        # –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Markdown (–≤–∏–∑—É–∞–ª—å–Ω–æ ‚Äî –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç)
        self.text_edit = QtGui.QTextEdit()
        self.text_edit.setAcceptRichText(False)  # –¢–æ–ª—å–∫–æ plain text (Markdown ‚Äî —ç—Ç–æ —Ç–µ–∫—Å—Ç!)
        self.text_edit.setFont(QtGui.QFont("Courier", 10))

        # –ö–Ω–æ–ø–∫–∏
        self.load_file_btn = QtGui.QPushButton("Load File (.txt, .md)")
        self.save_btn = QtGui.QPushButton("Save as Markdown")
        self.cancel_btn = QtGui.QPushButton("Cancel")

        self.load_file_btn.clicked.connect(self.load_file)
        self.save_btn.clicked.connect(self.save_text)
        self.cancel_btn.clicked.connect(self.reject)

        # –†–∞—Å–∫–ª–∞–¥–∫–∞
        btn_layout = QtGui.QHBoxLayout()
        btn_layout.addWidget(self.load_file_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(self.save_btn)
        btn_layout.addWidget(self.cancel_btn)

        layout = QtGui.QVBoxLayout()
        layout.addWidget(QtGui.QLabel("Enter or load your prompt, notes, or instructions (Markdown supported):"))
        layout.addWidget(self.text_edit)
        layout.addLayout(btn_layout)
        self.setLayout(layout)

    def load_file(self):
        file_path, _ = QtGui.QFileDialog.getOpenFileName(
            self,
            "Open Text File",
            "",
            "Text Files (*.txt *.md);;All Files (*)"
        )
        if not file_path:
            return

        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            self.text_edit.setPlainText(content)
            FreeCAD.Console.PrintMessage(f"[AIAssistant] Loaded: {file_path}\n")
        except Exception as e:
            QtGui.QMessageBox.critical(self, "Load Error", f"Cannot read file:\n{str(e)}")

    def save_text(self):
        text = self.text_edit.toPlainText().strip()
        if not text:
            QtGui.QMessageBox.warning(self, "Warning", "Text is empty!")
            return

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞: ai_prompt_1.md, ai_prompt_2.md...
        base_name = "ai_prompt"
        ext = ".md"
        counter = 1
        while os.path.exists(os.path.join(AI_DATA_DIR, f"{base_name}_{counter}{ext}")):
            counter += 1
        filename = f"{base_name}_{counter}{ext}"
        filepath = os.path.join(AI_DATA_DIR, filename)

        try:
            with open(filepath, 'w', encoding='utf-8') as f:
                f.write(text)
            FreeCAD.Console.PrintMessage(f"[AIAssistant] Text saved: {filepath}\n")
            QtGui.QMessageBox.information(self, "Saved", f"Text saved as:\n{filename}")
            self.accept()
        except Exception as e:
            QtGui.QMessageBox.critical(self, "Save Error", f"Cannot save file:\n{str(e)}")


# === –†–ê–ë–û–ß–ê–Ø –°–†–ï–î–ê ===
class AIAssistantWorkbench(FreeCADGui.Workbench):
    MenuText = "AI Assistant"
    ToolTip = "AI design assistant: images + text"

    def __init__(self):
        self.Icon = os.path.join(os.path.dirname(__file__), "Resources", "icons", "ai_assistant.svg")

    def Initialize(self):
        self.list = ["LoadImageCommand", "LoadTextCommand"]
        self.appendToolbar("AI Tools", self.list)
        self.appendMenu("AI Assistant", self.list)

    def GetClassName(self):
        return "Gui::PythonWorkbench"


# === –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ö–û–ú–ê–ù–î ===
FreeCADGui.addCommand("LoadImageCommand", LoadImageCommand())
FreeCADGui.addCommand("LoadTextCommand", LoadTextCommand())
```

---

## üñº –ù–æ–≤–∞—è –∏–∫–æ–Ω–∫–∞: `load_text.svg`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Resources/icons/load_text.svg`:

```xml
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
  <rect x="8" y="8" width="48" height="48" fill="none" stroke="black" stroke-width="4"/>
  <line x1="16" y1="20" x2="48" y2="20" stroke="black" stroke-width="2"/>
  <line x1="16" y1="28" x2="40" y2="28" stroke="black" stroke-width="2"/>
  <line x1="16" y1="36" x2="44" y2="36" stroke="black" stroke-width="2"/>
</svg>
```

---

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. **–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª** `.txt` –∏–ª–∏ `.md` ‚Üí –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. **–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é** (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Markdown-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `# –ó–∞–≥–æ–ª–æ–≤–æ–∫`, `**–∂–∏—Ä–Ω—ã–π**`, —Å–ø–∏—Å–∫–∏ –∏ —Ç.–¥.)
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å** –∫–∞–∫ `ai_prompt_1.md`, `ai_prompt_2.md`... –≤ –ø–∞–ø–∫—É `AIAssistant/data/`

> üî∏ FreeCAD –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç Markdown ‚Äî –Ω–æ –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –µ–≥–æ –∫–∞–∫ **–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π, –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ò–ò –∏ —Ç.–¥.

---

## üìÅ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ?

–ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —É –≤–∞—Å –±—É–¥–µ—Ç:

```
%APPDATA%\FreeCAD\AIAssistant\data\
‚îú‚îÄ‚îÄ image1.png
‚îú‚îÄ‚îÄ diagram.svg
‚îú‚îÄ‚îÄ ai_prompt_1.md
‚îî‚îÄ‚îÄ ai_prompt_2.md
```

–í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî –≥–æ—Ç–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ò–ò, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 3D-–º–æ–¥–µ–ª–µ–π –∏ —Ç.–¥.).

---

## ‚ñ∂Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∞–¥–¥–æ–Ω
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ FreeCAD
3. –í —Ä–∞–±–æ—á–µ–π —Å—Ä–µ–¥–µ **AI Assistant** –ø–æ—è–≤—è—Ç—Å—è –¥–≤–µ –∫–Ω–æ–ø–∫–∏:
   - **Load Image**
   - **Load Text**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å PNG
   - –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç:  
     ```markdown
     # –ú–æ—è –∏–¥–µ—è
     –°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–ø—É—Å –¥–ª—è –¥–∞—Ç—á–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.
     –†–∞–∑–º–µ—Ä—ã: 50√ó30√ó20 –º–º.
     –ú–∞—Ç–µ—Ä–∏–∞–ª: ABS.
     ```
   - –ù–∞–∂–∞—Ç—å **Save as Markdown**

‚úÖ –§–∞–π–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ `AIAssistant/data/`.

---

## üîú –ß—Ç–æ –±—É–¥–µ—Ç –≤ –ß–∞—Å—Ç–∏ 3?

- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö **–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–µ–∫—Å—Ç–æ–≤**
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å** —Ñ–∞–π–ª—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: **—Å–≤—è–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + —Ç–µ–∫—Å—Ç** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ –∫ —Å—Ö–µ–º–µ)

